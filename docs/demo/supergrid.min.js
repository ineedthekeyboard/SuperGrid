"use strict";$.widget("custom.SuperGrid",{options:{autoHeight:{enabled:!1,removeHeight:0},colReorder:!1,paginate:!0,pageSize:25,_grid:[],_header:[]},_create:function(){$.each(this.options.columns,function(t,e){e.width||(e.width=25)}),this.options._grid=[],this.options.pagination={currentPage:1,numberOfPages:1,pageSize:this.options.pageSize>0?this.options.pageSize:1},this._renderGrid(),this._bindListeners()},_bindListeners:function(){var t,e=this,i=!1;this.element.off("click",'.supergrid_header .supergrid_cell[data-sortable="true"]'),this.element.on("click",'.supergrid_header .supergrid_cell[data-sortable="true"]',function(t){var i,s=$(this),n=s.attr("data-sort"),r=s.attr("data-id"),a=e.options.columns;switch(e.element.find(".supergrid_header .supergrid_row").removeAttr("data-sort"),n){case"asc":i="desc";break;case"desc":default:i="asc"}$.each(a,function(t,e){return e.id===r?(e.sort=i,!0):void delete e.sort}),s.attr("data-sort",i),e._trigger("-sorted",t,{columns:e.options.columns}),e._renderGrid()}),this.element.off("mousedown",".supergrid_header .resize-handle"),this.element.on("mousedown",".supergrid_header .resize-handle",function(s){s.preventDefault(),t=this,i=!0,e.element.find(".supergrid_header .supergrid_cell").css("transition","linear"),e.element.find(".supergrid_header").addClass("resizing"),$(document).mousemove(function(i){$(t).css("left",i.pageX+2),e.element.find('.supergrid_header .supergrid_cell[data-id="'+$(t).data("id")+'"]').css("width",i.pageX-$(t).data("diff"))})}),this.element.off("click",".supergrid_footer button.left"),this.element.on("click",".supergrid_footer button.left",function(t){var i=$(this);"disabled"!==i.attr("data-state")&&(e.options.pagination.currentPage-=1,e._renderGrid())}),this.element.off("click",".supergrid_footer button.right"),this.element.on("click",".supergrid_footer button.right",function(t){var i=$(this);"disabled"!==i.attr("data-state")&&(e.options.pagination.currentPage+=1,e._renderGrid())}),$(document).mouseup(function(s){if(i){$(document).unbind("mousemove");var n=s.pageX-$(t).data("diff"),r=$(t).data("id");e.element.find('.supergrid_body .supergrid_cell[data-id="'+r+'"]').css("width",n),e.element.find(".supergrid_header .supergrid_cell").css("transition",".2s ease-in"),e._updateHeader(r,n),e.element.find(".supergrid_header").removeClass("resizing"),$(t).css("left","auto"),i=!1}})},_renderGrid:function(){this._sortData(),this._pagination(),this._buildGrid(),this.element.html(this.options._grid.join("")),this.options._grid=[],this._updatePages(this.options.pagination.currentPage),this._addMetaData(),this.options.colReorder&&this.element.find(".supergrid_header").sortable({start:function(t,e){e.item.startPos=e.item.index()},stop:function(t,e){var i=this.options.columns,s=0,n=[],r={};$.each($(".supergrid_header .supergrid_cell"),function(t,e){s=$(e).data("id"),r=i.filter(function(t){return t.id==s})[0]||{id:"",width:25},n.push(r)}),this.updateGrid(null,n)}.bind(this)}),this.options.autoHeight.enabled&&this._renderAutoHeight(),this._trigger("supergrid-rendered")},_renderAutoHeight:function(){var t=this.element.height(),e=this.element.find(".supergrid_header").height(),i=this.element.find(".supergrid_footer").height();this.options.removeHeight?null:this.options.removeHeight=0,this.element.find(".supergrid_body").height(t-(e+i-this.options.autoHeight.removeHeight))},_renderAutoSize:function(){},_sortData:function(){function t(e,i,s,n,r){for(var a,d=i,o=s,u=(i+s)/2,h=e[u.toFixed()][n];d<=o;){if(r){for(;e[d][n]<h;)d++;for(;e[o][n]>h;)o--}else{for(;e[d][n]>h;)d++;for(;e[o][n]<h;)o--}d<=o&&(a=e[d],e[d]=e[o],e[o]=a,d++,o--)}return i<o&&t(e,i,o,n,r),d<s&&t(e,d,s,n,r),e}var e,i,s,n,r=this._getColumnToSortBy();return!$.isEmptyObject(r)&&(e="asc"===r.sort,n=r.field,$.each(this.options.columns,function(t,e){if(e.id===n)return i=e.getSortValue,s=e.sortFunc,!1}),s?void this.options.data.sort(function(t,i){return s(t,i,e)}):void $.extend(this.options.data,t(this.options.data,0,this.options.data.length-1,n,e)))},_getColumnToSortBy:function(){var t={};return $.each(this.options.columns,function(e,i){if(i.sort)return t.field=i.id,t.sort=i.sort,!1}),t},_pagination:function(){var t=this.options.pagination;return this.options.paginate?(t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize),t.currentPage<1&&(t.currentPage=1),t.currentPage>t.numberOfPages&&(t.currentPage=t.numberOfPages),t.startIndex=(t.currentPage-1)*t.pageSize,t.startIndex>this.options.data.length-1&&(t.startIndex=this.options.data.length-1),t.endIndex=t.startIndex+t.pageSize,void(t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize))):(t.pageSize=this.options.data.length>0?this.options.data.length:0,t.currentPage=1,t.numberOfPages=1,t.startIndex=0,void(t.endIndex=t.pageSize))},_buildGrid:function(){this.options._grid.push('<div class="supergrid">'),this._buildHeader(),this._buildBody(),this.options.paginate&&this._buildFooter(),this.options._grid.push("</div>")},_buildHeader:function(){var t=0;this.options._grid.push(' <div class="supergrid_header">'),$.each(this.options.columns,function(e,i){var s=i.cellClass||"",n=i.width||"",r=i.id||"",a=i.name||"",d=i.sort||"",o=i.sortable||"",u="";u+='<div style="width:'+i.width+'px;" scope="col" class="supergrid_cell '+s+'" data-id="'+r+'" tabIndex="0" ',d&&(u+='data-sort="'+d+'" '),u+='data-sortable="'+o+'">',u+="<div>",u+=a,d&&(u+='<div class="sort-icon"></div>'),u+="</div>",u+="</div>",u+='<div class="resize-handle" data-id="'+r+'"data-diff="'+t+'"></div>',t+=n,this.options._grid.push(u)}.bind(this)),this.options._grid.push("</div>")},_updateHeader:function(t,e){var i=this,s=0;$.each(this.options.columns,function(n,r){var a=r.cellClass||"",d=t===r.id?r.width=e:r.width||"",o=r.id||"",u=r.name||"",h=r.sort||"",p=r.sortable||"",l="";l+='<div style="width:'+r.width+'px;" scope="col" class="supergrid_cell '+a+'" data-id="'+o+'" tabIndex="0" ',h&&(l+='data-sort="'+h+'" '),l+='data-sortable="'+p+'">',l+="<div>",l+=u,h&&(l+='<div class="sort-icon"></div>'),l+="</div>",l+="</div>",l+='<div class="resize-handle" data-id="'+o+'"data-diff="'+s+'"></div>',s+=d,i.options._header.push(l)}),i.element.find(".supergrid_header").html(this.options._header.join("")),i.options._header=[]},_buildBody:function(){function t(t,i){var r=i.id||"",a="";a+='<div class="supergrid_row section" data-id="'+r+'">',$.each(s,function(t,s){var n=s.cellClass||"";a+='<div style="width:'+s.width+'px;" class="supergrid_cell '+n+'" tabIndex="0"data-id="'+s.id+'">',a+="<div>",a+=e(i,s),a+="</div>",a+="</div>"}),a+="</div>",n.options._grid.push(a)}function e(t,e){var i=[],s=/\#(.*?)\#/,n=e.formatter,r=n,a=s.exec(n);if(!t)return"";if("function"==typeof n)return n(t);if("object"==typeof n&&(n=e.formatter),r=n,a=s.exec(n),r){for(;a;)i.push(a[0]),r=r.replace(a[0],""),a=s.exec(r);return $.each(i,function(e,i){var s=i.replace(/#|_/g,"");n=n.replace(i,t[s])}),n}return t[e.id]}var i=this.options.data,s=this.options.columns,n=this;this.options._grid.push('<div class="supergrid_body">'),$.each(i.slice(this.options.pagination.startIndex,this.options.pagination.endIndex),t),this.options._grid.push("</div>")},_buildFooter:function(){var t=this.options._grid;t.push('<div class="supergrid_footer">'),t.push('<div class="pager">'),t.push(' <button class="paginate left" tabindex="0"><i></i><i></i></button>'),t.push(' <div class="counter"></div>'),t.push(' <button class="paginate right" tabindex="0"><i></i><i></i></button>'),t.push("</div>"),t.push("</div>")},_updatePages:function(t){var e=this.element.find(".counter"),i=this.element.find(".paginate.left"),s=this.element.find(".paginate.right");t<=1&&i.attr("data-state","disabled"),t===this.options.pagination.numberOfPages&&s.attr("data-state","disabled"),e.html(t+"/"+this.options.pagination.numberOfPages)},_addMetaData:function(){var t=this;$.each(this.options.data,function(e,i){t.element.find('supergrid_row[data-id="'+i.id+'"]').data(i)})},updateGrid:function(t,e){t&&(this.options.data=$.extend([],t)),e&&(this.options.columns=$.extend([],e)),this.element.empty(),this._renderGrid()}});