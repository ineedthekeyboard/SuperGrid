!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function($){return $.widget("custom.SuperGrid",{options:{fixedHeader:{enabled:!1,removeHeight:0},colResize:!1,colReorder:!1,paginate:!0,accessibility:!1,pageSize:25,_grid:[],_header:[]},_create:function(){$.each(this.options.columns,function(t,i){i.width||(i.width=25)}),this.options._grid=[],this.options.pagination={currentPage:1,numberOfPages:1,pageSize:this.options.pageSize>0?this.options.pageSize:1},this._renderGrid(),this._bindListeners()},_bindListeners:function(){var t=this,i=!1,e;this.element.off("click",'.supergrid_header .supergrid_cell[data-sortable="true"]'),this.element.on("click",'.supergrid_header .supergrid_cell[data-sortable="true"]',function(i){var e=$(this),s=e.attr("data-sort"),n=e.attr("data-id"),r=t.options.columns,d;switch(t.element.find(".supergrid_header .supergrid_row").removeAttr("data-sort"),s){case"asc":d="desc";break;case"desc":d="asc";break;default:d="asc"}$.each(r,function(t,i){return i.id===n?(i.sort=d,!0):void delete i.sort}),e.attr("data-sort",d),t._trigger("-sorted",i,{columns:t.options.columns}),t._renderGrid()}),this.element.off("click",".supergrid_footer button.left"),this.element.on("click",".supergrid_footer button.left",function(){var i=$(this);"disabled"!==i.attr("data-state")&&(t.options.pagination.currentPage-=1,t._renderGrid())}),this.element.off("click",".supergrid_footer button.right"),this.element.on("click",".supergrid_footer button.right",function(){var i=$(this);"disabled"!==i.attr("data-state")&&(t.options.pagination.currentPage+=1,t._renderGrid())}),this.options.colResize&&(this.element.off("mousedown",".supergrids_header .resize-handle"),this.element.on("mousedown",".supergrid_header .resize-handle",function(s){s.preventDefault(),e=this,i=!0,t.element.find(".supergrid_header .supergrid_cell").css("transition","linear"),t.element.find(".supergrid_header").addClass("resizing"),$(document).mousemove(function(i){$(e).css("left",i.pageX+2),t.element.find('.supergrid_header .supergrid_cell[data-id="'+$(e).data("id")+'"]').css("width",i.pageX-$(e).data("diff"))})}),$(document).mouseup(function(s){var n,r;i&&($(document).unbind("mousemove"),n=s.pageX-$(e).data("diff"),r=$(e).data("id"),t.element.find('.supergrid_body .supergrid_cell[data-id="'+r+'"]').css("width",n),t.element.find(".supergrid_header .supergrid_cell").css("transition",".2s ease-in"),t._updateHeader(r,n),t.element.find(".supergrid_header").removeClass("resizing"),$(e).css("left","auto"),i=!1)}))},_renderGrid:function(){this._sortData(),this._pagination(),this._buildGrid(),this.element.html(this.options._grid.join("")),this.options._grid=[],this._updatePages(this.options.pagination.currentPage),this._addMetaData(),this.options.colReorder&&this.element.find(".supergrid_header").sortable({axis:"x",containment:"parent",tolerance:"pointer",start:function(t,i){i.item.startPos=i.item.index()},stop:function(){var t=this.options.columns,i=0,e=[],s={};$.each($(".supergrid_header .supergrid_cell"),function(n,r){i=$(r).data("id"),s=t.filter(function(t){return t.id.toString()===i.toString()})[0]||{id:"",width:25},e.push(s)}),this.updateGrid(null,e)}.bind(this)}).disableSelection(),this.options.fixedHeader.enabled&&this._renderfixedHeader(),this._resize(),this._trigger("supergrid-rendered")},_resize:function(t){t?this.element.find(".supergrid").width(t):this.element.find(".supergrid").width(this.options.widthTotal)},_renderfixedHeader:function(){var t=this.element.height(),i=this.element.find(".supergrid_header").height(),e=this.element.find(".supergrid_footer").height();this.options.removeHeight=this.options.removeHeight?null:0,this.element.find(".supergrid_body").height(t-(i+e+this.options.fixedHeader.removeHeight))},_sortData:function(){function t(i,e,s,n,r){for(var d=e,o=s,a,h=(e+s)/2,u=i[h.toFixed()][n];d<=o;){if(r){for(;i[d][n]<u;)d++;for(;i[o][n]>u;)o--}else{for(;i[d][n]>u;)d++;for(;i[o][n]<u;)o--}d<=o&&(a=i[d],i[d]=i[o],i[o]=a,d++,o--)}return e<o&&t(i,e,o,n,r),d<s&&t(i,d,s,n,r),i}var i=this._getColumnToSortBy(),e,s,n;return!$.isEmptyObject(i)&&(e="asc"===i.sort,n=i.field,$.each(this.options.columns,function(t,i){if(i.id===n)return s=i.sortFunc,!1}),s?void this.options.data.sort(function(t,i){return s(t,i,e)}):void $.extend(this.options.data,t(this.options.data,0,this.options.data.length-1,n,e)))},_getColumnToSortBy:function(){var t={};return $.each(this.options.columns,function(i,e){if(e.sort)return t.field=e.id,t.sort=e.sort,!1}),t},_pagination:function(){var t=this.options.pagination;return this.options.paginate?(t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize),t.currentPage<1&&(t.currentPage=1),t.currentPage>t.numberOfPages&&(t.currentPage=t.numberOfPages),t.startIndex=(t.currentPage-1)*t.pageSize,t.startIndex>this.options.data.length-1&&(t.startIndex=this.options.data.length-1),t.endIndex=t.startIndex+t.pageSize,void(t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize))):(t.pageSize=this.options.data.length>0?this.options.data.length:0,t.currentPage=1,t.numberOfPages=1,t.startIndex=0,void(t.endIndex=t.pageSize))},_buildGrid:function(){this.options._grid.push('<div class="supergrid">'),this.options.accessibility?(this.options.paginate=!1,this._pagination(),this.options._grid.push('<table class="supergrid_table" style="width:100%;table-layout: fixed;">'),this._buildAccessibilityHeader(),this._buildAccessibilityBody(),this.options._grid.push("</table>"),this.element.css("overflow","scroll"),this.element.css("height","500px")):(this._buildHeader(),this._buildBody(),this.options.paginate&&this._buildFooter()),this.options._grid.push("</div>")},_buildHeader:function(){var t=0,i=this;this.options._grid.push('<div class="supergrid_header">'),$.each(this.options.columns,function(e,s){var n=s.cellClass||"",r=s.width||"",d=s.id||"",o=s.name||"",a=s.sort||"",h=s.sortable||"",u="";u+='<div style="width:'+s.width+'px;" scope="col" class="supergrid_cell '+n+'" data-id="'+d+'" tabIndex="0" ',a&&(u+='data-sort="'+a+'" '),u+='data-sortable="'+h+'">',u+="<div>",u+=o,a&&(u+='<div class="sort-icon"></div>'),u+="</div>",u+="</div>",i.options.colResize&&(u+='<div class="resize-handle" data-id="'+d+'"data-diff="'+t+'"></div>'),t+=r,this.options._grid.push(u)}.bind(this)),this.options._grid.push("</div>"),this.options.widthTotal=t},_updateHeader:function(t,i){var e=this,s=0;$.each(this.options.columns,function(n,r){var d=r.cellClass||"",o=t===r.id?r.width=i:r.width||"",a=r.id||"",h=r.name||"",u=r.sort||"",p=r.sortable||"",l="";l+='<div style="width:'+r.width+'px;" scope="col" class="supergrid_cell '+d+'" data-id="'+a+'" tabIndex="0" ',u&&(l+='data-sort="'+u+'" '),l+='data-sortable="'+p+'">',l+="<div>",l+=h,u&&(l+='<div class="sort-icon"></div>'),l+="</div>",l+="</div>",e.options.colResize&&(l+='<div class="resize-handle" data-id="'+a+'"data-diff="'+s+'"></div>'),s+=o,e.options._header.push(l)}),e.options.widthTotal=s,e._resize(),e.element.find(".supergrid_header").html(this.options._header.join("")),e.options._header=[]},_buildBody:function(){function t(t,e){var r=e.id||"",d="";d+='<div class="supergrid_row section" data-id="'+r+'">',$.each(s,function(t,s){var n=s.cellClass||"";d+='<div style="width:'+s.width+'px;" class="supergrid_cell '+n+'" tabIndex="0"data-id="'+s.id+'">',d+="<div>",d+=i(e,s),d+="</div>",d+="</div>"}),d+="</div>",n.options._grid.push(d)}function i(t,i){var e=[],s=/\#(.*?)\#/,n=i.formatter,r,d;if(!t)return"";if("function"==typeof n)return n(t);if("object"==typeof n&&(n=i.formatter),r=n,d=s.exec(n),r){for(;d;)e.push(d[0]),r=r.replace(d[0],""),d=s.exec(r);return $.each(e,function(i,e){var s=e.replace(/#|_/g,"");n=n.replace(e,t[s])}),n}return t[i.id]}var e=this.options.data,s=this.options.columns,n=this;this.options._grid.push('<div class="supergrid_body">'),$.each(e.slice(this.options.pagination.startIndex,this.options.pagination.endIndex),t),this.options._grid.push("</div>")},_buildFooter:function(){var t=this.options._grid;t.push('<div class="supergrid_footer">'),t.push('<div class="pager">'),t.push(' <button class="paginate left" tabindex="0"><i></i><i></i></button>'),t.push(' <div class="counter"></div>'),t.push(' <button class="paginate right" tabindex="0"><i></i><i></i></button>'),t.push("</div>"),t.push("</div>")},_buildAccessibilityHeader:function(){var t=0;this.options._grid.push('<thead class="supergrid_header"><tr>'),$.each(this.options.columns,function(i,e){var s=e.cellClass||"",n=e.width||"",r=e.id||"",d=e.name||"",o=e.sort||"",a=e.sortable||"",h="";h+='<th style="width:'+e.width+'px;" scope="col" class="supergrid_cell '+s+'" data-id="'+r+'" tabIndex="0" ',o&&(h+='data-sort="'+o+'" '),h+='data-sortable="'+a+'">',h+="<div>",h+=d,o&&(h+='<div class="sort-icon"></div>'),h+="</div>",h+="</th>",t+=n,this.options._grid.push(h)}.bind(this)),this.options._grid.push("</tr></thead>"),this.options.widthTotal=t},_buildAccessibilityBody:function(){function t(t,e){var r=e.id||"",d="";d+='<tr class="supergrid_row section" data-id="'+r+'">',$.each(s,function(t,s){var n=s.cellClass||"";d+='<td style="width:'+s.width+'px;" class="supergrid_cell '+n+'" tabIndex="0"data-id="'+s.id+'">',d+="<div>",d+=i(e,s),d+="</div>",d+="</td>"}),d+="</tr>",n.options._grid.push(d)}function i(t,i){var e=[],s=/\#(.*?)\#/,n=i.formatter,r,d;if(!t)return"";if("function"==typeof n)return n(t);if("object"==typeof n&&(n=i.formatter),r=n,d=s.exec(n),r){for(;d;)e.push(d[0]),r=r.replace(d[0],""),d=s.exec(r);return $.each(e,function(i,e){var s=e.replace(/#|_/g,"");n=n.replace(e,t[s])}),n}return t[i.id]}var e=this.options.data,s=this.options.columns,n=this;this.options._grid.push('<tbody class="supergrid_body">'),$.each(e.slice(this.options.pagination.startIndex,this.options.pagination.endIndex),t),this.options._grid.push("</tbody>")},_updatePages:function(t){var i=this.element.find(".counter"),e=this.element.find(".paginate.left"),s=this.element.find(".paginate.right");t<=1&&e.attr("data-state","disabled"),t===this.options.pagination.numberOfPages&&s.attr("data-state","disabled"),i.html(t+"/"+this.options.pagination.numberOfPages)},_addMetaData:function(){var t=this;$.each(this.options.data,function(i,e){t.element.find('.supergrid_row[data-id="'+e.id+'"]').data(e)})},updateGrid:function(t,i){t&&(this.options.data=$.extend([],t)),i&&(this.options.columns=$.extend([],i)),this.element.empty(),this._renderGrid()}})});