$.widget("custom.SuperGrid-table","custom.SuperGrid",{_bindListeners:function(){var t=this;this.element.off("click",'.supergrid_header td[data-sortable="true"]'),this.element.on("click",'.supergrid_header td[data-sortable="true"]',function(e){var r,i=$(this),d=i.attr("data-sort"),a=i.attr("data-id"),s=t.options.columns;switch(t.element.find(".supergrid_header td").removeAttr("data-sort"),d){case"asc":r="desc";break;case"desc":default:r="asc"}$.each(s,function(t,e){return e.id===a?(e.sort=r,!0):void delete e.sort}),i.attr("data-sort",r),t._trigger("-sorted",e,{columns:t.options.columns}),t._renderGrid()})},_renderGrid:function(){this.element.html(this._buildGrid())},_buildGrid:function(){var t=this._buildHeader(),e=this._buildBody(),r='<table class="supergrid" style="width:100%;table-layout: fixed;">';return this.options.fixedHeader?r='<table class="supergrid supergrid-fheader">'+t+'</table><div class="supergrid-body">'+r:r+=t,r+="<tbody>",r+=e,r+="</tbody>",r+=this.options.fixedHeader?"</table></div>":"</table>"},_buildHeader:function(){var t='<thead class="supergrid_header">';return t+="<tr>",$.each(this.options.columns,function(e,r){var i=r.cellClass||"",d=(r.width||"",r.id||""),a=r.name||"",s=r.sort||"",o=r.sortable||"";t+='<td style="width:'+r.width+'px;" scope="col" class="'+i+'" data-id="'+d+'" tabIndex="0"',s&&(t+='data-sort="'+s+'" '),t+='data-sortable="'+o+'">',t+="<div>",t+=a,s&&(t+='<div class="sort-icon"></div>'),t+="</div>",t+="</td>"}),t+="</tr>",t+="</thead>"},_buildBody:function(){var t=this.options.data,e=this.options.columns,r=this,i="";return $.each(t,function(t,d){var a=d.id||"";i+='<tr class="section" data-id="'+a+'">',$.each(e,function(t,e){var a=e.cellClass||"";i+='<td style="width:'+e.width+'px; class="'+a+'" tabIndex="0">',i+="<div>",i+=r._buildCell(d,e),i+="</div>",i+="</td>"}),i+="</tr>"}),i},_buildCell:function(t,e){var r=[],i=/\#(.*?)\#/,d=e.formatter,a=d,s=i.exec(d);if(!t)return"";if("function"==typeof d)return d(t);if("object"==typeof d&&(d=e.formatter),a=d,s=i.exec(d),a){for(;s;)r.push(s[0]),a=a.replace(s[0],""),s=i.exec(a);return $.each(r,function(e,r){var i=r.replace(/#|_/g,"");d=d.replace(r,t[i])}),d}return t[e.id]}});
$.widget("custom.SuperGrid",{options:{paginate:!1,_grid:[],_header:[],pageSize:20},_create:function(){$.each(this.options.columns,function(t,i){i.width||(i.width=25)}),this.options._grid=[],this.options.pagination={currentPage:1,numberOfPages:1,pageSize:this.options.pageSize>0?this.options.pageSize:1},this._renderGrid(),this._bindListeners()},_bindListeners:function(){var t,i=this,e=!1;this.element.off("click",'.supergrid_header .supergrid_cell[data-sortable="true"]'),this.element.on("click",'.supergrid_header .supergrid_cell[data-sortable="true"]',function(t){var e,s=$(this),d=s.attr("data-sort"),n=s.attr("data-id"),a=i.options.columns;switch(i.element.find(".supergrid_header .supergrid_row").removeAttr("data-sort"),d){case"asc":e="desc";break;case"desc":default:e="asc"}$.each(a,function(t,i){return i.id===n?(i.sort=e,!0):void delete i.sort}),s.attr("data-sort",e),i._trigger("-sorted",t,{columns:i.options.columns}),i._renderGrid()}),this.element.off("mousedown",".supergrid_header .resize-handle"),this.element.on("mousedown",".supergrid_header .resize-handle",function(s){s.preventDefault(),t=this,e=!0,i.element.find(".supergrid_header .supergrid_cell").css("transition","linear"),i.element.find(".supergrid_header").addClass("resizing"),$(document).mousemove(function(e){$(t).css("left",e.pageX+2),i.element.find('.supergrid_header .supergrid_cell[data-id="'+$(t).data("id")+'"]').css("width",e.pageX-$(t).data("diff"))})}),$(document).mouseup(function(s){if(e){$(document).unbind("mousemove");var d=s.pageX-$(t).data("diff"),n=$(t).data("id");i.element.find('.supergrid_body .supergrid_cell[data-id="'+n+'"]').css("width",d),i.element.find(".supergrid_header .supergrid_cell").css("transition",".2s ease-in"),i._updateHeader(n,d),i.element.find(".supergrid_header").removeClass("resizing"),$(t).css("left","auto"),e=!1}})},_renderGrid:function(){this._sortData(),this._pagination(),this._buildGrid(),this.element.html(this.options._grid.join("")),this.options._grid=[],this.updatePages(this.options.pagination.currentPage),this._addMetaData(),this._trigger("-rendered")},_addMetaData:function(){var t=this;$.each(this.options.data,function(i,e){t.element.find('supergrid_row[data-id="'+e.id+'"]').data(e)})},_sortData:function(){function t(i,e,s,d,n){for(var a,r=e,o=s,u=(e+s)/2,h=i[u.toFixed()][d];r<=o;){if(n){for(;i[r][d]<h;)r++;for(;i[o][d]>h;)o--}else{for(;i[r][d]>h;)r++;for(;i[o][d]<h;)o--}r<=o&&(a=i[r],i[r]=i[o],i[o]=a,r++,o--)}return e<o&&t(i,e,o,d,n),r<s&&t(i,r,s,d,n),i}var i,e,s,d,n=this._getSorting();return!$.isEmptyObject(n)&&(i="asc"===n.sort,d=n.field,$.each(this.options.columns,function(t,i){if(i.id===d)return e=i.getSortValue,s=i.sortFunc,!1}),s?void this.options.data.sort(function(t,e){return s(t,e,i)}):void $.extend(this.options.data,t(this.options.data,0,this.options.data.length-1,d,i)))},_getSorting:function(){var t={};return $.each(this.options.columns,function(i,e){if(e.sort)return t.field=e.id,t.sort=e.sort,!1}),t},_buildGrid:function(){this.options._grid.push('<div class="supergrid">'),this._buildHeader(),this._buildBody(),this._buildFooter(),this.options._grid.push("</div>")},_buildHeader:function(){var t=0;this.options._grid.push(' <div class="supergrid_header">'),$.each(this.options.columns,function(i,e){var s=e.cellClass||"",d=e.width||"",n=e.id||"",a=e.name||"",r=e.sort||"",o=e.sortable||"",u="";u+='<div style="width:'+e.width+'px;" scope="col" class="supergrid_cell '+s+'" data-id="'+n+'" tabIndex="0" ',r&&(u+='data-sort="'+r+'" '),u+='data-sortable="'+o+'">',u+="<div>",u+=a,r&&(u+='<div class="sort-icon"></div>'),u+="</div>",u+="</div>",u+='<div class="resize-handle" data-id="'+n+'"data-diff="'+t+'"></div>',t+=d,this.options._grid.push(u)}.bind(this)),this.options._grid.push("</div>")},_updateHeader:function(t,i){var e=this,s=0;$.each(this.options.columns,function(d,n){var a=n.cellClass||"",r=t===n.id?n.width=i:n.width||"",o=n.id||"",u=n.name||"",h=n.sort||"",p=n.sortable||"",c="";c+='<div style="width:'+n.width+'px;" scope="col" class="supergrid_cell '+a+'" data-id="'+o+'" tabIndex="0" ',h&&(c+='data-sort="'+h+'" '),c+='data-sortable="'+p+'">',c+="<div>",c+=u,h&&(c+='<div class="sort-icon"></div>'),c+="</div>",c+="</div>",c+='<div class="resize-handle" data-id="'+o+'"data-diff="'+s+'"></div>',s+=r,e.options._header.push(c)}),e.element.find(".supergrid_header").html(this.options._header.join("")),e.options._header=[]},_buildBody:function(){function t(t,e){var n=e.id||"",a="";a+='<div class="supergrid_row section" data-id="'+n+'">',$.each(s,function(t,s){var d=s.cellClass||"";a+='<div style="width:'+s.width+'px;" class="supergrid_cell '+d+'" tabIndex="0"data-id="'+s.id+'">',a+="<div>",a+=i(e,s),a+="</div>",a+="</div>"}),a+="</div>",d.options._grid.push(a)}function i(t,i){var e=[],s=/\#(.*?)\#/,d=i.formatter,n=d,a=s.exec(d);if(!t)return"";if("function"==typeof d)return d(t);if("object"==typeof d&&(d=i.formatter),n=d,a=s.exec(d),n){for(;a;)e.push(a[0]),n=n.replace(a[0],""),a=s.exec(n);return $.each(e,function(i,e){var s=e.replace(/#|_/g,"");d=d.replace(e,t[s])}),d}return t[i.id]}var e=this.options.data,s=this.options.columns,d=this;this.options._grid.push('<div class="supergrid_body">'),$.each(e.slice(this.options.pagination.startIndex,this.options.pagination.endIndex),t),this.options._grid.push("</div>")},_buildFooter:function(){var t=this.options._grid;t.push('<div class="supergrid_footer">'),t.push(' <button class="paginate left"><i></i><i></i></button>'),t.push(' <div class="counter"></div>'),t.push(' <button class="paginate right"><i></i><i></i></button>'),t.push("</div>")},_pagination:function(){var t=this.options.pagination;return this.options.paginate?(t.startIndex=(t.currentPage-1)*t.pageSize,t.startIndex>this.options.data.length-1&&(t.startIndex=this.options.data.length-1),t.endIndex=t.startIndex+t.pageSize,t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize),void console.log(t)):(t.pageSize=this.options.data.length>0?this.options.data.length:0,t.currentPage=1,t.numberOfPages=1,t.startIndex=0,t.endIndex=t.pageSize,void console.log(t))},_updatePages:function(t){var i=this.element.find(".counter"),e=this.element.find(".paginate.left");this.element.find(".paginate.right");t<=1&&e.attr("data-state","disabled"),i.html(t+"/"+this.options.pagination.numberOfPages)},updateGrid:function(t,i){t&&(this.options.data=$.extend([],t)),i&&(this.options.columns=$.extend([],i)),this.element.empty(),this._renderGrid()}});