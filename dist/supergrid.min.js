!function(t){"function"==typeof define&&define.amd?define(["jquery"],t):t(jQuery)}(function(t){return t.widget("custom.SuperGrid",{options:{fixedHeader:{enabled:!1,removeHeight:0},colResize:!1,colReorder:!1,paginate:!0,accessibility:!1,pageSize:25,_grid:[],_header:[]},_create:function(){t.each(this.options.config.columns,function(t,i){i.width||(i.width=25)}),this.options._grid=[],this.options.pagination={currentPage:1,numberOfPages:1,pageSize:this.options.pageSize>0?this.options.pageSize:1},this._renderGrid(),this._bindListeners()},_bindListeners:function(){var i,e=this,s=!1;this.element.off("click",'.supergrid_header .supergrid_cell[data-sortable="true"]'),this.element.on("click",'.supergrid_header .supergrid_cell[data-sortable="true"]',function(i){var s,n=t(this),o=n.attr("data-sort"),d=n.attr("data-id"),r=e.options.config.columns;switch(e.element.find(".supergrid_header .supergrid_row").removeAttr("data-sort"),o){case"asc":s="desc";break;case"desc":s="asc";break;default:s="asc"}t.each(r,function(t,i){return i.id===d?(i.sort=s,!0):void delete i.sort}),n.attr("data-sort",s),e._trigger("-sorted",i,{columns:e.options.config.columns}),e._renderGrid()}),this.element.off("click",".supergrid_footer button.left"),this.element.on("click",".supergrid_footer button.left",function(){var i=t(this);"disabled"!==i.attr("data-state")&&(e.options.pagination.currentPage-=1,e._renderGrid())}),this.element.off("click",".supergrid_footer button.right"),this.element.on("click",".supergrid_footer button.right",function(){var i=t(this);"disabled"!==i.attr("data-state")&&(e.options.pagination.currentPage+=1,e._renderGrid())}),this.options.colResize&&(this.element.off("mousedown",".supergrids_header .resize-handle"),this.element.on("mousedown",".supergrid_header .resize-handle",function(n){n.preventDefault(),i=this,s=!0,e.element.find(".supergrid_header .supergrid_cell").css("transition","linear"),e.element.find(".supergrid_header").addClass("resizing"),t(document).mousemove(function(s){t(i).css("left",s.pageX+2),e.element.find('.supergrid_header .supergrid_cell[data-id="'+t(i).data("id")+'"]').css("width",s.pageX-t(i).data("diff"))})}),t(document).mouseup(function(n){var o,d;s&&(t(document).unbind("mousemove"),o=n.pageX-t(i).data("diff"),d=t(i).data("id"),e.element.find('.supergrid_body .supergrid_cell[data-id="'+d+'"]').css("width",o),e.element.find(".supergrid_header .supergrid_cell").css("transition",".2s ease-in"),e._updateHeader(d,o),e.element.find(".supergrid_header").removeClass("resizing"),t(i).css("left","auto"),s=!1)}))},_renderGrid:function(){this._sortData(),this._pagination(),this._buildGrid(),this.element.html(this.options._grid.join("")),this.options._grid=[],this._updatePages(this.options.pagination.currentPage),this._addMetaData(),this.options.colReorder&&this.element.find(".supergrid_header").sortable({axis:"x",containment:"parent",tolerance:"pointer",start:function(t,i){i.item.startPos=i.item.index()},stop:function(){var i=this.options.config.columns,e=0,s=[],n={};t.each(t(".supergrid_header .supergrid_cell"),function(o,d){e=t(d).data("id"),n=i.filter(function(t){return t.id.toString()===e.toString()})[0]||{id:"",width:25},s.push(n)}),this.updateGrid(null,s)}.bind(this)}).disableSelection(),this.options.fixedHeader.enabled&&this._renderfixedHeader(),this._resize(),this._trigger("-rendered")},_resize:function(t){t?this.element.find(".supergrid").width(t):this.element.find(".supergrid").width(this.options.widthTotal)},_renderfixedHeader:function(){var t=this.element.height(),i=this.element.find(".supergrid_header").height(),e=this.element.find(".supergrid_body"),s=this.element.find(".supergrid_footer").height();this.options.removeHeight=this.options.removeHeight?null:0,e.height(t-(i+s+this.options.fixedHeader.removeHeight)),!e.hasClass("fixed")&&e.addClass("fixed")},_sortData:function(){function i(t,e,s,n,o){for(var d,r=e,a=s,h=(e+s)/2,c=t[h.toFixed()][n];r<=a;){if(o){for(;t[r][n]<c;)r++;for(;t[a][n]>c;)a--}else{for(;t[r][n]>c;)r++;for(;t[a][n]<c;)a--}r<=a&&(d=t[r],t[r]=t[a],t[a]=d,r++,a--)}return e<a&&i(t,e,a,n,o),r<s&&i(t,r,s,n,o),t}var e,s,n=this._getColumnToSortBy(),o=this.options.config.customSorters&&this.options.config.customSorters[n.field];return!t.isEmptyObject(n)&&(e="asc"===n.sort,s=n.field,o?void this.options.data.sort(function(t,i){var s=o(t,i,e);return console.log(s),s}):void t.extend(this.options.data,i(this.options.data,0,this.options.data.length-1,s,e)))},_getColumnToSortBy:function(){var i={};return t.each(this.options.config.columns,function(t,e){if(e.sort)return i.field=e.id,i.sort=e.sort,!1}),i},_pagination:function(){var t=this.options.pagination;return this.options.paginate?(t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize),t.currentPage<1&&(t.currentPage=1),t.currentPage>t.numberOfPages&&(t.currentPage=t.numberOfPages),t.startIndex=(t.currentPage-1)*t.pageSize,t.startIndex>this.options.data.length-1&&(t.startIndex=this.options.data.length-1),t.endIndex=t.startIndex+t.pageSize,void(t.numberOfPages=Math.ceil(this.options.data.length/t.pageSize))):(t.pageSize=this.options.data.length>0?this.options.data.length:0,t.currentPage=1,t.numberOfPages=1,t.startIndex=0,void(t.endIndex=t.pageSize))},_buildGrid:function(){this.options._grid.push('<div class="supergrid">'),this.options.accessibility?(this.options.paginate=!1,this._pagination(),this.options._grid.push('<table class="supergrid_table" style="width:100%;table-layout: fixed;">'),this._buildAccessibilityHeader(),this._buildAccessibilityBody(),this.options._grid.push("</table>"),this.element.css("overflow","scroll"),this.element.css("height","500px")):(this._buildHeader(),this._buildBody(),this.options.paginate&&this._buildFooter()),this.options._grid.push("</div>")},_buildHeader:function(){var i=0,e=this;this.options._grid.push('<div class="supergrid_header">'),t.each(this.options.config.columns,function(t,s){var n=s.cellClass||"",o=s.width||"",d=s.id||"",r=s.name||"",a=s.sort||"",h=s.sortable||"",c="";c+='<div style="width:'+s.width+'px;" scope="col" class="supergrid_cell '+n+'" data-id="'+d+'" tabIndex="0" ',a&&(c+='data-sort="'+a+'" '),c+='data-sortable="'+h+'">',c+="<div>",c+=r,a&&(c+='<div class="sort-icon"></div>'),c+="</div>",c+="</div>",e.options.colResize&&(c+='<div class="resize-handle" data-id="'+d+'"data-diff="'+i+'"></div>'),i+=o,this.options._grid.push(c)}.bind(this)),this.options._grid.push("</div>"),this.options.widthTotal=i},_updateHeader:function(i,e){var s=this,n=0;t.each(this.options.config.columns,function(t,o){var d=o.cellClass||"",r=i===o.id?o.width=e:o.width||"",a=o.id||"",h=o.name||"",c=o.sort||"",l=o.sortable||"",p="";p+='<div style="width:'+o.width+'px;" scope="col" class="supergrid_cell '+d+'" data-id="'+a+'" tabIndex="0" ',c&&(p+='data-sort="'+c+'" '),p+='data-sortable="'+l+'">',p+="<div>",p+=h,c&&(p+='<div class="sort-icon"></div>'),p+="</div>",p+="</div>",s.options.colResize&&(p+='<div class="resize-handle" data-id="'+a+'"data-diff="'+n+'"></div>'),n+=r,s.options._header.push(p)}),s.options.widthTotal=n,s._resize(),s.element.find(".supergrid_header").html(this.options._header.join("")),s.options._header=[]},_buildBody:function(){function i(i,s){var d=s.id||"",r="";r+='<div class="supergrid_row section" data-id="'+d+'">',t.each(n,function(t,i){var n=i.cellClass||"";r+='<div style="width:'+i.width+'px;" class="supergrid_cell '+n+'" tabIndex="0"data-id="'+i.id+'">',r+="<div>",r+=e(s,i),r+="</div>",r+="</div>"}),r+="</div>",o.options._grid.push(r)}function e(i,e){var s,n,d=[],r=/\#(.*?)\#/,a=o.options.config.formatters&&o.options.config.formatters[e.id];if(!i)return"";if("function"==typeof a)return a(i,o.options.data);if("object"==typeof a)return a;if(s=a,n=r.exec(a),s){for(;n;)d.push(n[0]),s=s.replace(n[0],""),n=r.exec(s);return t.each(d,function(t,e){var s=e.replace(/#|_/g,"");a=a.replace(e,i[s])}),a}return i[e.id]}var s=this.options.data,n=this.options.config.columns,o=this;this.options._grid.push('<div class="supergrid_body">'),t.each(s.slice(this.options.pagination.startIndex,this.options.pagination.endIndex),i),this.options._grid.push("</div>")},_buildFooter:function(){var t=this.options._grid;t.push('<div class="supergrid_footer">'),t.push('<div class="pager">'),t.push(' <button class="paginate left" tabindex="0"><i></i><i></i></button>'),t.push(' <div class="counter"></div>'),t.push(' <button class="paginate right" tabindex="0"><i></i><i></i></button>'),t.push("</div>"),t.push("</div>")},_buildAccessibilityHeader:function(){var i=0;this.options._grid.push('<thead class="supergrid_header"><tr>'),t.each(this.options.config.columns,function(t,e){var s=e.cellClass||"",n=e.width||"",o=e.id||"",d=e.name||"",r=e.sort||"",a=e.sortable||"",h="";h+='<th style="width:'+e.width+'px;" scope="col" class="supergrid_cell '+s+'" data-id="'+o+'" tabIndex="0" ',r&&(h+='data-sort="'+r+'" '),h+='data-sortable="'+a+'">',h+="<div>",h+=d,r&&(h+='<div class="sort-icon"></div>'),h+="</div>",h+="</th>",i+=n,this.options._grid.push(h)}.bind(this)),this.options._grid.push("</tr></thead>"),this.options.widthTotal=i},_buildAccessibilityBody:function(){function i(i,s){var d=s.id||"",r="";r+='<tr class="supergrid_row section" data-id="'+d+'">',t.each(n,function(t,i){var n=i.cellClass||"";r+='<td style="width:'+i.width+'px;" class="supergrid_cell '+n+'" tabIndex="0"data-id="'+i.id+'">',r+="<div>",r+=e(s,i),r+="</div>",r+="</td>"}),r+="</tr>",o.options._grid.push(r)}function e(i,e){var s,n,o=[],d=/\#(.*?)\#/,r=e.formatter;if(!i)return"";if("function"==typeof r)return r(i);if("object"==typeof r&&(r=e.formatter),s=r,n=d.exec(r),s){for(;n;)o.push(n[0]),s=s.replace(n[0],""),n=d.exec(s);return t.each(o,function(t,e){var s=e.replace(/#|_/g,"");r=r.replace(e,i[s])}),r}return i[e.id]}var s=this.options.data,n=this.options.config.columns,o=this;this.options._grid.push('<tbody class="supergrid_body">'),t.each(s.slice(this.options.pagination.startIndex,this.options.pagination.endIndex),i),this.options._grid.push("</tbody>")},_updatePages:function(t){var i=this.element.find(".counter"),e=this.element.find(".paginate.left"),s=this.element.find(".paginate.right");t<=1&&e.attr("data-state","disabled"),t===this.options.pagination.numberOfPages&&s.attr("data-state","disabled"),i.html(t+"/"+this.options.pagination.numberOfPages)},_addMetaData:function(){var i=this;t.each(this.options.data,function(t,e){i.element.find('.supergrid_row[data-id="'+e.id+'"]').data(e)})},updateGrid:function(i,e){i&&(this.options.data=t.extend([],i)),e&&(this.options.config.columns=t.extend([],e)),this._trigger("-config-updated",null,{data:this.options.data,columns:this.options.config.columns}),this.element.empty(),this._renderGrid()}})});